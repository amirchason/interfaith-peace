---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

const base = import.meta.env.BASE_URL;

// Get all articles
const allArticles = await getCollection('articles');

// Sort by published date (newest first)
const articles = allArticles.sort((a, b) =>
  b.data.publishedDate.getTime() - a.data.publishedDate.getTime()
);

// Group by category
const articlesByCategory = articles.reduce((acc, article) => {
  const category = article.data.category;
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(article);
  return acc;
}, {} as Record<string, typeof articles>);

// Format date
function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
}

// Category display names
const categoryNames: Record<string, string> = {
  'counter-extremism': 'Counter-Extremism',
  'interfaith': 'Interfaith Dialogue',
  'peace-teachings': 'Peace Teachings',
  'scripture-study': 'Scripture Study',
};

const categoryColors: Record<string, string> = {
  'counter-extremism': '#E74C3C',
  'interfaith': '#95A5A6',
  'peace-teachings': '#27AE60',
  'scripture-study': '#3498DB',
};
---

<BaseLayout
  title="Articles - Interfaith Peace Initiative"
  description="Explore our comprehensive articles on counter-extremism, interfaith dialogue, peace teachings, and more. Evidence-based research and actionable insights."
>
  <!-- Hero Section -->
  <section class="hero-section py-20 px-4" style="background: linear-gradient(135deg, #95A5A615, #95A5A605);">
    <div class="container mx-auto max-w-6xl text-center">
      <h1 class="text-5xl md:text-6xl font-bold mb-6 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
        Articles
      </h1>
      <p class="text-xl text-text-secondary max-w-3xl mx-auto mb-8">
        Explore comprehensive research, analysis, and actionable insights on religious extremism, interfaith peace, and moderate empowerment.
      </p>

      <div class="flex flex-wrap justify-center gap-4">
        <div class="stat-card px-6 py-4 bg-background-primary/80 backdrop-blur-sm rounded-lg shadow-md">
          <div class="text-3xl font-bold text-primary">{articles.length}</div>
          <div class="text-sm text-text-secondary">Articles</div>
        </div>
        <div class="stat-card px-6 py-4 bg-background-primary/80 backdrop-blur-sm rounded-lg shadow-md">
          <div class="text-3xl font-bold text-primary">{Object.keys(articlesByCategory).length}</div>
          <div class="text-sm text-text-secondary">Categories</div>
        </div>
        <div class="stat-card px-6 py-4 bg-background-primary/80 backdrop-blur-sm rounded-lg shadow-md">
          <div class="text-3xl font-bold text-primary">
            {articles.filter(a => a.data.series).length}
          </div>
          <div class="text-sm text-text-secondary">Series Articles</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Articles by Category -->
  <section class="articles-section py-16 px-4 bg-background-secondary">
    <div class="container mx-auto max-w-6xl">
      {Object.entries(articlesByCategory).map(([category, categoryArticles]) => (
        <div class="category-section mb-16">
          <!-- Category Header -->
          <div class="flex items-center gap-4 mb-8">
            <div
              class="w-2 h-12 rounded-full"
              style={`background-color: ${categoryColors[category] || '#95A5A6'};`}
            ></div>
            <div>
              <h2 class="text-3xl font-bold">
                {categoryNames[category] || category}
              </h2>
              <p class="text-text-secondary">
                {categoryArticles.length} article{categoryArticles.length !== 1 ? 's' : ''}
              </p>
            </div>
          </div>

          <!-- Articles Grid -->
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            {categoryArticles.map(article => (
              <article class="article-card bg-background-primary rounded-lg overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 transform hover:scale-105">
                <a href={`${base}/articles/${article.slug}/`} class="block">
                  <!-- Article Image -->
                  {article.data.image && (
                    <div class="article-image aspect-video overflow-hidden">
                      <img
                        src={article.data.image}
                        alt={article.data.imageAlt}
                        class="w-full h-full object-cover"
                        loading="lazy"
                      />
                    </div>
                  )}

                  <!-- Article Content -->
                  <div class="p-6">
                    <!-- Series Badge -->
                    {article.data.series && (
                      <div class="mb-3">
                        <span
                          class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium"
                          style={`background-color: ${categoryColors[category]}15; color: ${categoryColors[category]};`}
                        >
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                          </svg>
                          {article.data.series} #{article.data.seriesOrder}
                        </span>
                      </div>
                    )}

                    <!-- Title -->
                    <h3 class="text-xl font-bold mb-3 text-text-primary group-hover:text-primary transition-colors">
                      {article.data.title}
                    </h3>

                    <!-- Description -->
                    <p class="text-sm text-text-secondary mb-4 line-clamp-3">
                      {article.data.description}
                    </p>

                    <!-- Meta -->
                    <div class="flex items-center justify-between text-xs text-text-secondary">
                      <time datetime={article.data.publishedDate.toISOString()}>
                        {formatDate(article.data.publishedDate)}
                      </time>
                      {article.data.featured && (
                        <span class="flex items-center gap-1 text-primary font-medium">
                          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                          </svg>
                          Featured
                        </span>
                      )}
                    </div>

                    <!-- Tags -->
                    {article.data.tags && article.data.tags.length > 0 && (
                      <div class="flex flex-wrap gap-2 mt-4">
                        {article.data.tags.slice(0, 3).map(tag => (
                          <span class="text-xs px-2 py-1 bg-background-secondary rounded-full text-text-secondary">
                            #{tag}
                          </span>
                        ))}
                      </div>
                    )}
                  </div>
                </a>
              </article>
            ))}
          </div>
        </div>
      ))}
    </div>
  </section>

  <!-- CTA Section -->
  <section class="cta-section py-16 px-4">
    <div class="container mx-auto max-w-4xl text-center">
      <div class="bg-gradient-to-br from-primary/10 to-secondary/10 rounded-2xl p-12 backdrop-blur-sm">
        <h2 class="text-3xl md:text-4xl font-bold mb-6">
          Want to Contribute?
        </h2>
        <p class="text-lg text-text-secondary mb-8 max-w-2xl mx-auto">
          We're always looking for expert contributors, researchers, and practitioners to share their insights on peace and counter-extremism.
        </p>
        <a
          href="mailto:contact@interfaithpeace.org"
          class="inline-flex items-center gap-2 px-8 py-3 bg-primary hover:bg-primary-hover text-white rounded-lg transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
          Contact Us
        </a>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .article-card {
    transition: all 0.3s ease;
  }

  .article-card:hover .article-image img {
    transform: scale(1.05);
    transition: transform 0.3s ease;
  }
</style>
